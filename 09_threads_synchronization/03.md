## Clean thread exit

- Define exit function, which frees up the allocated memory
- Define thread function: Lock the thread cancellation
- Allocate 1K memory and print notification
- Add exit function passing the new memory as parameter
- Unlock the thread cancellation
- Print 4 messages in 4 seconds
- Pop exit function, executing it

### thread-clean-exit.c

```
#include<pthread.h>
void exit_func(void * arg)
{
  free(arg);
  printf("Freed the allocated memory.\n");
}
void * thread_func(void * arg)
{
  pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, NULL);
  void * mem = malloc(1024); 
  printf("Allocated some memory.\n");
  pthread_cleanup_push(exit_func, mem);
  pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);
  
  int i;
  for(i=0; i<4; i++)
  {
    sleep(1);
	printf("Important process %i is running...\n", i);
  }
  pthread_cleanup_pop();
}
```