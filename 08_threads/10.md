## Thread cancellations

- Create a thread
- Try to cancel it
- Wait for it to finish

![10_1.png](10_1.png) 

### canceltest.c (part 1)
```
#include<stdio.h>
#include<pthread.h>
int main(int argc, char ** argv)
{
  pthread_t thread;
  pthread_create(&thread, NULL, thread_func, NULL);
  while(i < 1) sleep(1);
  pthread_cancel(thread);
  printf("Requested to cancel the thread!\n");
  pthread_join(thread, NULL);
  printf("The thread is stopped!\n");
  return EXIT_SUCCESS; // 0
}
```

- Mark the thread as uncancellable
- ... while itâ€™s working
- ... and until we enable cancellations
- ... AND reach a cancelability point

![10_2.png](10_2.png) 

### canceltest.c (part 2)
```
void * thread_func(void * arh)
{
  pthread_setcancelsate(PTHREAD_CANCEL_DISABLE, NULL);
  for(i=0; i<4; i++)
  {
    sleep(1);
	printf("I am still running!\n");
  }
  pthread_setcancelsate(PTHREAD_CANCEL_ENABLE, NULL);
  pthread_testcancel();
  printf("YOU WILL NOT STOP ME!!!\n");
}
```

Compile with support for threads:
```
gcc canceltest.c -o canceltest -lpthread
```
