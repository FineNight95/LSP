## Joining two Threads

- Define the helper permutations generation functions 
- Define the threads function
- Allocate a vector of size **arg**
- Initialize the vector with the first permutation and print it
- While there is next permutation:
- Generate it, print it and synchronize
- Deallocate the vector and exit thread

![07_1.png](07_1.png) 

### threads.c (part 1)

```
void print_vect(int *v, int n)
{
  for(int i=0;i<size; i++)
  {
    printf("%i",v[i]);
  }
  printf("\n");
}
int next_permutation(int *v, int n)
{
  ...
}
void * thread_func(void *arg)
{
  int size = *(int *) arg;
  int *v = malloc(sizeof(int)*size);
  for(int i=0; i<size; i++) v[i] = i+1;
  print_vec(v, size)
  while(next_permutation(v, size)) 
  {
    print_vect(v, size);
	sync();
  }
  free(v);
  pthread_exit(arg);
}
```

- In the main function function:
- Start thread function with size 4, exit on error
- Start thread function with size 3, exit on error
- Wait for the first thread and print a notification, exit on error
- Wait for the second thread and print a notification, exit on error
- Print **Job Done!** and quit

![07_2.png](07_2.png) 

### threads.c (part 2)
```
#include<pthread.h>
...
int main(int argc, char ** argv)
{
  int size1, size2, result;
  void *ret;
  pthread_t thread1, thread2;
  
  size1 = 4;
  result = pthread_create(&thread1, NULL, thread_func, &size1);
  if(result != 0)
  {
    printf("Error!\n");
    return EXIT_FAILURE; // -1
  }
  
  size2 = 3;
  result = pthread_create(&thread1, NULL, thread_func, &size2);
  if(result != 0)
  {
    printf("Error!\n");
    return EXIT_FAILURE; // -1
  }
  
  result = pthread_join(&thread1, &ret);
  if(result != 0)
  {
    printf("Error!\n");
    return EXIT_FAILURE; // -1
  }
  else printf("Thread finished with result %i\n", *(int *)ret);
  
  result = pthread_join(&thread2, &ret);
  if(result != 0)
  {
    printf("Error!\n");
    return EXIT_FAILURE; // -1
  }
  else printf("Thread finished with result %i\n", *(int *)ret);
  
  printf("Job Done!\n");
  return EXIT_SUCCESS; // 0
}
```

Compile with support for threads:
```
gcc threads.c -o threads -lpthread
```